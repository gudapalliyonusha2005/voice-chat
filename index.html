<script>
  const chatBox = document.getElementById("chat");
  const button = document.getElementById("talk");
  const status = document.getElementById("status");

  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  const recognition = new SpeechRecognition();
  recognition.lang = "en-US";
  recognition.interimResults = false;

  function speak(text) {
    const speech = new SpeechSynthesisUtterance(text);
    speech.lang = "en-US";
    window.speechSynthesis.speak(speech);
  }

  function addMessage(message, cls) {
    const p = document.createElement("p");
    p.textContent = message;
    p.className = cls;
    chatBox.appendChild(p);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  recognition.onstart = function () {
    status.textContent = "ðŸŽ¤ Listening...";
  };

  recognition.onend = function () {
    status.textContent = "";
  };

  recognition.onresult = function(event) {
    const userText = event.results[0][0].transcript;
    addMessage("You: " + userText, "user");

    // ðŸ”Š Speak user's own input
    speak(userText);

    // ðŸ”¹ Replace with real AI backend call if needed
    let botReply = "I heard you say: " + userText;

    addMessage("Assistant: " + botReply, "bot");
    speak(botReply);
  };

  recognition.onerror = function(event) {
    addMessage("Error: " + event.error, "bot");
    status.textContent = "";
  };

  button.addEventListener("click", async () => {
    try {
      // ðŸ”’ Request permission to use the mic
      await navigator.mediaDevices.getUserMedia({ audio: true });
      recognition.start();
    } catch (err) {
      console.error("Microphone access denied:", err);
      addMessage("Microphone access denied. Please allow access to use voice features.", "bot");
    }
  });
</script>
